<html>
<head>
    <title>Earth Defender</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="bower_components/threejs/build/three.js"></script>
    <script src="bower_components/stats.js/build/stats.min.js"></script>
    <script src="bower_components/threejs/examples/js/controls/OrbitControls.js"></script>
    <script src="bower_components/threejs/examples/js/libs/dat.gui.min.js"></script>
</head>
<body>
    <script type="text/x-glsl" id="vertex">
        varying vec2 vUv;
        varying vec3 outRadiance;
        uniform float lightPower;
        uniform vec3 rho;
        uniform sampler2D texture;

        const float PI = 3.14159;

        void main() {
            vUv = uv;
            vec3 pointLightPosition = vec3(400.0, 0.0, 0.0);
            vec3 ambient = vec3(0.09, 0.09, 0.1);
			// transforms the vertex from object space to clip space coords
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
			vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
			vec3 transformedNormal = normalMatrix * normal;
			vec4 lPosition = viewMatrix * vec4( pointLightPosition, 1.0 );
			vec3 lVector = lPosition.xyz - mvPosition.xyz;
			float beta = lightPower / ( 4.0  * PI * length(lVector) );
			lVector = normalize( lVector );
			float dotProduct = dot( transformedNormal, lVector );
			float pointLightWeighting = max( dotProduct, 0.0 );
			outRadiance = beta * pointLightWeighting * rho / PI + ambient;
		}
	</script>

    <script type="text/x-glsl" id="fragment">
        varying vec2 vUv;
        uniform sampler2D texture;
        varying vec3 outRadiance;

        void main() {
		    gl_FragColor = texture2D(texture, vUv) + vec4(outRadiance, 1.0) - vec4(0.1, 0.1, 0.1, 1.0);
		    //gl_FragColor = vec4(outRadiance, 1.0);
        }
		</script>
    <script src="js/main.js"></script>ï¿¼
</body>
</html>
